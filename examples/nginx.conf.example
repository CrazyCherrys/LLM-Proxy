# LLM-Proxy Nginx é…ç½®ç¤ºä¾‹
# åŒ…å«ä»£ç†è®¾ç½®ã€ç¼“å­˜æ§åˆ¶å’Œ WebSocket æ”¯æŒ

# WebSocket æ”¯æŒ
map $http_upgrade $connection_upgrade {
    default upgrade;
    ''      close;
}

server {
    listen 80;
    server_name localhost;

    # è®¿é—®æ—¥å¿—
    access_log /var/log/nginx/access.log combined;
    error_log /var/log/nginx/error.log warn;

    # ä»£ç†é…ç½®
    location ^~ /v1/ {
        # è®¾ç½®ä»£ç†ç›®æ ‡æœåŠ¡å™¨
        proxy_pass ${TARGET_API};
        
        # è®¾ç½®ä»£ç†è¯·æ±‚å¤´
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $connection_upgrade;
        
        # è®¾ç½®HTTPç‰ˆæœ¬
        proxy_http_version 1.1;
        
        # è¶…æ—¶è®¾ç½®
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
        
        # ç¼“å­˜æ§åˆ¶
        proxy_cache_bypass $http_upgrade;
        add_header X-Cache $upstream_cache_status;
        
        # é™æ€æ–‡ä»¶ç¼“å­˜
        location ~* \.(gif|png|jpg|css|js|woff|woff2)$ {
            expires 1m;
            add_header Cache-Control "public, no-transform";
        }
    }

    # å¥åº·æ£€æŸ¥
    location = /health {
        access_log off;
        return 200 'healthy\n';
    }

    # æ ¹è·¯å¾„å¤„ç†
    location = / {
        add_header Content-Type "text/html; charset=utf-8";
        return 200 '<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>LLM-Proxy</title>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            background: #f8f9fa;
        }
        .container {
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        h1 {
            font-family: "Helvetica Neue", Arial, sans-serif;
            font-size: 2.5rem;
            color: #2c3e50;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ•Šï¸ LLM-Proxy - è®©APIè°ƒç”¨å›å½’ç®€å•æœ¬è´¨</h1>
    </div>
</body>
</html>';
    }
} 