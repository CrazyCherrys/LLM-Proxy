# Nginx 配置文件
# 包含代理设置和缓存控制

# WebSocket 支持
map $http_upgrade $connection_upgrade {
    default upgrade;
    ''      close;
}

server {
    listen 80;
    server_name localhost;

    # 代理配置开始
    location ^~ /v1/ {
        # 设置代理目标服务器
        proxy_pass https://vg.v1api.cc;
        
        # 设置代理请求头
        proxy_set_header Host vg.v1api.cc;                    # 设置目标主机名
        proxy_set_header X-Real-IP $remote_addr;                # 传递真实客户端IP
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;  # 传递代理链路信息
        proxy_set_header X-Forwarded-Proto $scheme;             # 传递原始协议
        proxy_set_header REMOTE-HOST $remote_addr;              # 传递远程主机信息
        proxy_set_header Upgrade $http_upgrade;                 # 支持WebSocket升级
        proxy_set_header Connection $connection_upgrade;        # 设置WebSocket连接
        
        # 设置HTTP版本
        proxy_http_version 1.1;
        
        # 隐藏特定响应头
        proxy_hide_header Upgrade;                             # 隐藏升级头
        proxy_hide_header X-Powered-By;                        # 隐藏服务器信息
        
        # 添加缓存状态头
        add_header X-Cache $upstream_cache_status;             # 显示缓存状态
        
        # 静态文件缓存控制
        set $static_file2sMrnVUl 0;                           # 初始化静态文件标志
        if ( $uri ~* "\.(gif|png|jpg|css|js|woff|woff2)$" ) { # 匹配静态文件扩展名
            set $static_file2sMrnVUl 1;                       # 设置静态文件标志
            expires 1m;                                        # 设置缓存过期时间为1分钟
        }
        if ( $static_file2sMrnVUl = 0 ) {                     # 非静态文件
            add_header Cache-Control no-cache;                 # 禁用缓存
        }
    }

    # 根路径处理
    location = / {
        add_header Content-Type "text/html; charset=utf-8";    # 设置内容类型
        
        # 返回自定义HTML页面
        return 200 '<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>API</title>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            background: #f8f9fa;
        }
        .container {
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        h1 {
            font-family: "Helvetica Neue", Arial, sans-serif;
            font-size: 2.5rem;
            color: #2c3e50;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🕊️ API，智能随行 - 让API调用回归简单本质</h1>
    </div>
</body>
</html>';
    }
} 